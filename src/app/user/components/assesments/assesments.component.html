<div class="main-body">
  <div class="Assesment-container" *ngIf="isAssesmentCompleted === false && isAssesmentStarted === true">

    <div class="informative-container">

      <div style="display: flex;justify-content: space-between;">
        <div
          style="width: 100%; height: 100%; flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 4px; display: inline-flex">
          <div
            style="align-self: stretch; justify-content: flex-start; align-items: center; gap: 43px; display: inline-flex">
            <div
              style="flex-direction: column; justify-content: flex-start; align-items: flex-start; gap: 28px; display: inline-flex">
              <div
                style="align-self: stretch; justify-content: space-between; align-items: center; display: inline-flex">
                <div
                  style="color: #333333; font-size: 18px; font-family: Calibri; font-weight: 700; line-height: 25.20px; word-wrap: break-word">
                  Total {{totalQuestions}} Questions</div>
              </div>
            </div>
          </div>
          <div><span
              style="color: #333333; font-size: 16px; font-family: Calibri; font-weight: 400; line-height: 22.40px; word-wrap: break-word">All
              questions are mandatory to answer </span><span
              style="color: #EB5757; font-size: 16px; font-family: Calibri; font-weight: 400; line-height: 22.40px; word-wrap: break-word">*</span>
          </div>
        </div>

        <span [ngClass]="{'circle pulse': isPulsating}">
          <nz-progress [nzStrokeWidth]="20" [nzPercent]="(((TimeCounter * 1.65)) / 100) * 100" nzType="circle"
            nzTitle="3 done" [nzFormat]="formatOne" [nzStatus]="timerStatus" [nzWidth]="70"></nz-progress>
        </span>

      </div>

      <div style="display: flex; justify-content: space-between;margin: 15px 0px;">
        <div>
          <div><span
              style="color: #333333; font-size: 16px; font-family: Calibri; font-weight: 400; line-height: 22.40px; word-wrap: break-word">Question</span><span
              style="color: #333333; font-size: 16px; font-family: Calibri; font-weight: 400; line-height: 22.40px; word-wrap: break-word">
            </span><span
              style="color: #3194A0; font-size: 20px; font-family: Calibri; font-weight: 700; line-height: 28px; word-wrap: break-word;margin-left: 5px;">{{currentQuestionIndex
              + 1}}</span><span
              style="color: #828282; font-size: 16px; font-family: Calibri; font-weight: 400; line-height: 22.40px; word-wrap: break-word">/{{totalQuestions}}</span>
          </div>
        </div>

        <span style="text-align: center;">
          Attempt Remaining: {{attempt - 1}}
        </span>
      </div>

    </div>
    <div class="question-container" *ngFor="let questions of currentQuestion">
      <div class="question-heading">
        <h2>{{questions.question}}</h2>
      </div>
      <div class="answer-container">
        <form [formGroup]="buttonSizeForm">



          <div *ngIf="questions.questionType === 'MCQ'">

            <div style="display: flex; flex-direction: column; gap: 32px;">
              <div style="display: flex; gap: 32px;">
                <div class="questionoptbtn" (click)="selectOptionmcq('A')"
                  [class.selected]="buttonSizeForm.get('radioValue')?.value === 'A'">
                  <div class="questionoptbtn1" [class.selected]="buttonSizeForm.get('radioValue')?.value === 'A'">A
                  </div>
                  <input type="radio" id="optionA" formControlName="radioValue" [value]="'A'" style="display: none" />
                  <label style="font-size: 16px;
                    font-family: Calibri;
                    font-weight: 400;" for="optionA">{{questions.optionA}}</label>
                </div>

                <div class="questionoptbtn" (click)="selectOptionmcq('B')"
                  [class.selected]="buttonSizeForm.get('radioValue')?.value === 'B'">
                  <div class="questionoptbtn1" [class.selected]="buttonSizeForm.get('radioValue')?.value === 'B'">B
                  </div>

                  <input type="radio" id="optionB" formControlName="radioValue" [value]="'B'" style="display: none" />
                  <label style="font-size: 16px;
                    font-family: Calibri;
                    font-weight: 400;" for="optionB">{{questions.optionB}}</label>
                </div>
              </div>

              <div style="display: flex; gap: 32px;">
                <div class="questionoptbtn" (click)="selectOptionmcq('C')"
                  [class.selected]="buttonSizeForm.get('radioValue')?.value === 'C'">
                  <div class="questionoptbtn1" [class.selected]="buttonSizeForm.get('radioValue')?.value === 'C'">C
                  </div>

                  <input type="radio" id="optionC" formControlName="radioValue" [value]="'C'" style="display: none" />
                  <label style="font-size: 16px;
                    font-family: Calibri;
                    font-weight: 400;" for="optionC">{{questions.optionC}}</label>
                </div>

                <div class="questionoptbtn" (click)="selectOptionmcq('D')"
                  [class.selected]="buttonSizeForm.get('radioValue')?.value === 'D'">
                  <div class="questionoptbtn1" [class.selected]="buttonSizeForm.get('radioValue')?.value === 'D'">D
                  </div>

                  <input type="radio" id="optionD" formControlName="radioValue" [value]="'D'" style="display: none" />
                  <label style="font-size: 16px;
                    font-family: Calibri;
                    font-weight: 400;" for="optionD">{{questions.optionD}}</label>
                </div>
              </div>
            </div>






          </div>


          <div *ngIf="questions.questionType === 'MCA'">


            <div style="display: flex; flex-direction: column; gap: 32px;">
              <div style="display: flex; gap: 32px;">
                <div class="questionoptbtn" [class.selected]="isSelected('A')" (click)="selectOption('A')">
                  <div class="questionoptbtn1" [class.selected]="isSelected('A')">A</div>
                  <input type="radio" id="optionA" formControlName="radioValue" [value]="'A'" style="display: none" />
                  <label style="font-size: 16px;
                    font-family: Calibri;
                    font-weight: 400;" for="optionA">{{questions.optionA}}</label>
                </div>

                <div class="questionoptbtn" [class.selected]="isSelected('B')" (click)="selectOption('B')">
                  <div class="questionoptbtn1" [class.selected]="isSelected('B')" (click)="selectOption('B')">B</div>

                  <input type="radio" id="optionB" formControlName="radioValue" [value]="'B'" style="display: none" />
                  <label style="font-size: 16px;
                    font-family: Calibri;
                    font-weight: 400;" for="optionB">{{questions.optionB}}</label>
                </div>
              </div>

              <div style="display: flex; gap: 32px;">
                <div class="questionoptbtn" [class.selected]="isSelected('C')" (click)="selectOption('C')">
                  <div class="questionoptbtn1" [class.selected]="isSelected('C')" (click)="selectOption('C')">C</div>

                  <input type="radio" id="optionC" formControlName="radioValue" [value]="'C'" style="display: none" />
                  <label style="font-size: 16px;
                    font-family: Calibri;
                    font-weight: 400;" for="optionC">{{questions.optionC}}</label>
                </div>

                <div class="questionoptbtn" [class.selected]="isSelected('D')" (click)="selectOption('D')">
                  <div class="questionoptbtn1" [class.selected]="isSelected('D')" (click)="selectOption('D')">D</div>

                  <input type="radio" id="optionD" formControlName="radioValue" [value]="'D'" style="display: none" />
                  <label style="font-size: 16px;
                    font-family: Calibri;
                    font-weight: 400;" for="optionD">{{questions.optionD}}</label>
                </div>
              </div>
            </div>

            <div style="margin-top: 20px;"> <span
                style="color: #333333; font-size: 16px; font-family: Calibri; font-weight: 700; line-height: 22.40px; word-wrap: break-word"><i>Select
                  all the correct options</i></span></div>

          </div>



          <div *ngIf="questions.questionType === 'TF'">


            <div style="display: flex; gap: 32px;">
              <div class="questionoptbtn" (click)="selectOptiontf('A')"
                [class.selected]="buttonSizeForm.get('booleanValue')?.value === 'A'">
                <div class="questionoptbtn1" [class.selected]="buttonSizeForm.get('booleanValue')?.value === 'A'">A
                </div>
                <input type="radio" id="optionA" formControlName="booleanValue" [value]="'A'" style="display: none" />
                <label style="font-size: 16px;
                  font-family: Calibri;
                  font-weight: 400;" for="optionA">{{questions.optionA}}</label>
              </div>

              <div class="questionoptbtn" (click)="selectOptiontf('B')"
                [class.selected]="buttonSizeForm.get('booleanValue')?.value === 'B'">
                <div class="questionoptbtn1" [class.selected]="buttonSizeForm.get('booleanValue')?.value === 'B'">B
                </div>

                <input type="radio" id="optionB" formControlName="booleanValue" [value]="'B'" style="display: none" />
                <label style="font-size: 16px;
                  font-family: Calibri;
                  font-weight: 400;" for="optionB">{{questions.optionB}}</label>
              </div>
            </div>

            <!-- <label>
                <input type="radio" formControlName="booleanValue" [value]="'A'" />
                {{questions.optionA}}
              </label>
              <label>
                <input type="radio" formControlName="booleanValue" [value]="'B'" />
                {{questions.optionB}}
              </label> -->
          </div>



          <div *ngIf="questions.questionType === 'Blanks'">
            <input nz-input formControlName="inputValue" placeholder="Enter A value" nzSize="large" />
          </div>


        </form>
      </div>

      <div class="assesmentbtns" style="display: flex;justify-content: center;gap:15px ;">
        <button nz-button class="start-button"
          style="background-color: transparent;color:#181818;border: 1px solid #333333;"
          (click)="goBackToCourse()">Cancel</button>
        <button nz-button class="start-button" nzType="primary" (click)="nextQuestion(questions)"
          *ngIf="currentQuestionIndex < totalQuestions -1">Next</button>
        <button nz-button nzType="primary" class="start-button" (click)="onSubmit(questions)"
          *ngIf="currentQuestionIndex === totalQuestions -1">Submit</button>
      </div>
    </div>
  </div>






  <div class="result" *ngIf="isAssesmentCompleted === true">
    <!-- *-->
    <div class="test-dashboard">

      <div style="display:flex; justify-content:space-evenly;">
        <button nz-button nzType="primary" (click)="goBackToCourse()">Back To Course </button>
        <button nz-button nzType="primary">Retake Assessment</button>
      </div>
    </div>
    <div class="test-body">
      <form [formGroup]="resultForm" *ngFor="let index of groupedQuestions.keys()" class="result-form">
        <div *ngFor="let questions of groupedQuestions.get(index);let i = index;" class="result-array ">
          <h2 class="assesmentcmpltque">{{questions.question}}</h2>
          <div *ngIf="questions.questionType == 'MCQ'">
            <label>
              <input type="radio" [value]="'A'" [checked]="questions.selectedAnswer == 'A'" />
              {{ questions.optionA }}
            </label>
            <!-- Repeat this for other options (B, C, D) -->
            <label>
              <input type="radio" [value]="'B'" [checked]="questions.selectedAnswer === 'B'" />
              {{ questions.optionB }}
            </label>
            <label>
              <input type="radio" [value]="'C'" [checked]="questions.selectedAnswer === 'C'" />
              {{ questions.optionC }}
            </label>
            <label>
              <input type="radio" [value]="'D'" [checked]="questions.selectedAnswer === 'D'" />
              {{ questions.optionD }}
            </label>

            <div>
              <label>Correct Answer: {{ questions.correctAnswer }}</label>
              <label>Attempts: {{ questions.attempts }}</label>
            </div>
          </div>


          <div *ngIf="questions.questionType === 'MCA'">

            <label>
              <input type="checkbox" [value]="'A'" [checked]="questions.selectedAnswer == 'A'" />
              {{ questions.optionA }}
            </label>
            <!-- Repeat this for other options (B, C, D) -->
            <label>
              <input type="checkbox" [value]="'B'" [checked]="questions.selectedAnswer == 'B'" />
              {{ questions.optionB }}
            </label>
            <!-- Repeat this for other options (B, C, D) -->
            <label>
              <input type="checkbox" [value]="'C'" [checked]="questions.selectedAnswer == 'C'" />
              {{ questions.optionC }}
            </label>
            <!-- Repeat this for other options (B, C, D) -->
            <label>
              <input type="checkbox" [value]="'D'" [checked]="questions.selectedAnswer == 'D'" />
              {{ questions.optionD }}
            </label>
            <div>
              <label>Correct Answer : {{ questions.correctAnswer }}</label>
              <label>Attempts : {{ questions.attempts }}</label>
            </div>
          </div>

          <div *ngIf="questions.questionType === 'TF'">
            <label>
              <input type="radio" [value]="'A'" [checked]="questions.selectedAnswer == 'A'" />
              {{ questions.optionA }}
            </label>
            <!-- Repeat this for other options (B) -->
            <label>
              <input type="radio" [value]="'B'" [checked]="questions.selectedAnswer == 'B'" />
              {{ questions.optionB }}
            </label>
            <div>
              <label>Correct Answer : {{ questions.correctAnswer }}</label>
              <label>Attempts : {{ questions.attempts }}</label>
            </div>
          </div>
          <div *ngIf="questions.questionType === 'Blanks'">
            <input nz-input [value]="questions.selectedAnswer" placeholder="Enter A value" nzSize="large" />
            <div>
              <label>Correct Answer : {{ questions.correctAnswer }}</label>
              <label>Attempts : {{ questions.attempts }}</label>
            </div>
          </div>
        </div>

      </form>
    </div>


  </div>


  <nz-modal [nzWidth]="700" [(nzVisible)]="isResultVisible" nzCentered [nzFooter]="modalFooter">
    <ng-container *nzModalContent>
      <img src="assets/icons/assessmentcompleted.svg" alt="">

      <div style="margin: 20px 0px;">
        <div
          style="color: #333333; font-size: 24px; font-family: Calibri; font-weight: 700; line-height: 33.60px; word-wrap: break-word">
          Assessment Submitted Successfully</div>
        <div
          style="width: 100%; text-align: center; color: #4F4F4F; font-size: 18px; font-family: Calibri; font-weight: 400; word-wrap: break-word">
          You have successfully submitted the assessment. Your result is ready.</div>
      </div>

      <div
        style="background-color: rgba(49, 148, 160, 0.10);display: flex;justify-content: space-between;padding: 12px;border-radius: 10px;">

        <div style="display: flex;flex-direction: column;">
          <div class="count"><span nz-icon style="color: #97a031;margin-right: 8px;
    " nzType="question-circle" nzTheme="fill"></span> {{totalQuestion}}</div>
          <div class="counttext">Total Questions</div>
        </div>

        <div style="display: flex;flex-direction: column;">
          <div class="count"><span nz-icon style="color: #3194A0;margin-right: 8px;
    " nzType="check-circle" nzTheme="fill"></span>{{totalAttempts}} </div>
          <div class="counttext">Total Attempts</div>
        </div>

        <div style="display: flex;flex-direction: column;">
          <div class="count"><span style="color: #FFC618;margin-right: 8px;
    " nz-icon nzType="star" nzTheme="fill"></span>{{this.points}}</div>
          <div class="counttext">Score Obtained</div>
        </div>


      </div>

    </ng-container>

    <ng-template #modalFooter>

      <div class="modalbuttons">
        <button class="modalcancel" (click)="reviewTest()">Review Test</button>
        <button style="background-color: #3194A0;color: white;" (click)="gotoRatings()">Continue</button>
      </div>
    </ng-template>
  </nz-modal>


  <nz-modal [(nzVisible)]="isRatingVisible" nzTitle="Add Rating & Review" nzCentered [nzFooter]="modalFooter2">
    <ng-container *nzModalContent>
      <nz-rate class="large" [(ngModel)]="ratingValue" [nzTooltips]="tooltips"></nz-rate>

      <div style="margin: 15px 0px;">
        <div style="margin-bottom: 10px;"><span
            style="color: #333333; font-size: 16px; font-family: Calibri; font-weight: 700; line-height: 22.40px; word-wrap: break-word">Write
            Feedback </span><span
            style="color: #BDBDBD; font-size: 16px; font-family: Calibri; font-style: italic; font-weight: 700; line-height: 22.40px; word-wrap: break-word">(Optional)</span>
        </div>
        <textarea nz-input
          placeholder="What's your personal experience while taking this course? What did you think of it?"
          [nzAutosize]="{ minRows: 5}" [(ngModel)]="feedValue">
        </textarea>

      </div>
      <!-- <button nz-button nzType="primary" (click)="submitFeedback()">Submit</button> -->
    </ng-container>
    <ng-template #modalFooter2>

      <div class="modalbuttons">
        <button class="modalcancel" (click)="handleCancel()">Cancel</button>
        <button style="background-color: #3194A0;color: white;" (click)="submitFeedback()">Submit</button>
      </div>
    </ng-template>


  </nz-modal>
</div>

<div class="result-container" *ngIf="isAssesmentCompleted === false && isAssesmentStarted === false">
  <div class="rule-container">
    <div class="rule-header">
      <h1>Assessment Guidelines</h1>
    </div>
    <div class="rule-content">

      <div style="gap: 15px;display: flex;flex-direction: column;">
        <div>
          <h2>Question Types:
          </h2>
          This assessment comprises various question formats, such as Multiple-Choice Questions (MCQs), Multiple Correct
          Answers (MCAs), and True or False inquiries.
        </div>
        <div>
          <h2>Time Allocation:
          </h2>
          Participants are allotted one minute per question to choose or provide the correct answer.
        </div>
        <div>
          <h2>Scoring Criteria:
          </h2>
          A score of 1 point is awarded for each correct answer on the first attempt. No points are awarded for answers
          submitted on the second or subsequent attempts. Incorrect responses do not incur any negative marking.
        </div>
      </div>



    </div>

    <div class="rule-action">
      <button style="display: flex;justify-content: center;" class="start-button" nz-button
        (click)="goBackToCourse()">Cancel</button>
      <button style="display: flex;justify-content: center;" class="start-button" nz-button nzType="primary"
        (click)="startAssesments()">Start Assesment</button>
    </div>
  </div>
</div>